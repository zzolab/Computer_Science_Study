# 교착상태

- 두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 결과적으로 아무것도 완료되지 못하는 상태

출처 : [https://ko.wikipedia.org/wiki/교착\_상태](https://ko.wikipedia.org/wiki/%EA%B5%90%EC%B0%A9_%EC%83%81%ED%83%9C)

## 철학자들의 만찬 문제

1. 일정 시간 생각을 한다.

2. 왼쪽 포크가 사용 가능해질 때까지 대기한다. 만약 사용 가능하다면 집어든다.

3. 오른쪽 포크가 사용 가능해질 때까지 대기한다. 만약 사용 가능하다면 집어든다.

4. 양쪽의 포크를 잡으면 일정 시간만큼 식사를 한다.

5. 오른쪽 포크를 내려놓는다.

6. 왼쪽 포크를 내려놓는다.

7. 다시 1번으로 돌아간다.

```
모든 철학자가 왼쪽 포크를 사용하게 되면 4번 조건이 충족되지 않으므로 아무것도 진행할 수가 없게 되는데, 이것이 교착(Deadlock)상태이다.
```

## **해결하는 방법**

1. 철학자들 중 하나는 포크를 오른쪽부터 잡게 한다고 생각해 보자. 예를 들어 1번 철학자는 왼쪽부터, 2번 철학자는 오른쪽부터 잡는다.
2. 1번 철학자가 왼쪽 포크만 잡은 상태에서 행동권이 2번 철학자에게 넘어간다고 하더라도, 2번 철학자는 자신의 오른쪽 포크가 현재 사용 불가능하기 때문에, 첫번째 포크를 잡으려는 상황에서 멈춰 있게 된다.
3. 이 상황에서 1번 철학자로 다시 행동권이 넘어오게 되면 1번 철학자는 자신의 오른쪽 포크를 잡고 다시 식사를 할 수 있게 된다.

출처 : [https://namu.wiki/w/식사하는 철학자 문제](https://namu.wiki/w/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94%20%EC%B2%A0%ED%95%99%EC%9E%90%20%EB%AC%B8%EC%A0%9C)

## \***\*교착 상태의 조건\*\***

1. [상호배제](https://ko.wikipedia.org/wiki/%EC%83%81%ED%98%B8%EB%B0%B0%EC%A0%9C)(Mutual exclusion) : 프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구한다.
2. [점유대기](https://ko.wikipedia.org/w/index.php?title=%EC%A0%90%EC%9C%A0%EB%8C%80%EA%B8%B0&action=edit&redlink=1)(Hold and wait) : 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다린다.
3. [비선점](https://ko.wikipedia.org/wiki/%EB%B9%84%EC%84%A0%EC%A0%90_%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81)(No preemption) : 프로세스가 어떤 자원의 사용을 끝낼 때까지 그 자원을 뺏을 수 없다.
4. [순환대기](https://ko.wikipedia.org/w/index.php?title=%EC%88%9C%ED%99%98%EB%8C%80%EA%B8%B0&action=edit&redlink=1)(Circular wait) : 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있다.

이 조건 중에서 한 가지라도 만족하지 않으면 교착 상태는 발생하지 않는다.

## \***\*교착 상태의 예방\*\***

1. 상호배제 조건의 제거
   - 교착 상태는 두 개 이상의 프로세스가 공유가능한 자원을 사용할 때 발생하는 것이므로 공유 불가능한, 즉 상호 배제 조건을 제거하면 교착 상태를 해결할 수 있다.
2. 점유와 대기 조건의 제거
   - 한 프로세스에 수행되기 전에 모든 자원을 할당시키고 나서 점유하지 않을 때에는 다른 프로세스가 자원을 요구하도록 하는 방법이다. 자원 과다 사용으로 인한 효율성, 프로세스가 요구하는 자원을 파악하는 데에 대한 비용, 자원에 대한 내용을 저장 및 복원하기 위한 비용, [기아 상태](https://ko.wikipedia.org/wiki/%EA%B8%B0%EC%95%84_%EC%83%81%ED%83%9C), 무한대기 등의 문제점이 있다.
3. 비선점 조건의 제거
   - 비선점 프로세스에 대해 선점 가능한 프로토콜을 만들어 준다.
4. 환형 대기 조건의 제거
   - 자원 유형에 따라 순서를 매긴다.

## 교착 상태 회피

- 자원이 어떻게 요청될지에 대한 추가정보를 제공하도록 요구하는 것으로 시스템에 circular wait가 발생하지 않도록 자원 할당 상태를 검사

### 은행원 알고리즘

- 총 자원의 양과 현재 할당한 자원의 양을 기준으로 안전 또는 불안전 상태로 나누고 안전 상태로 가도록 자원을 할당하는 알고리즘

- 남아있는 돈은 20원
- 여기서 안전 순서열은?
  - 고객 2 -> 고객 1 -> 고객 3
  - 고객 2 -> 고객 3 -> 고객 1
  - 고객 3 -> 고객 1 -> 고객 2
  - 고객 3 -> 고객 2 -> 고객 1

출처 : [https://wookkingkim.tistory.com/m/entry/운영체제-The-Bankers-Algorithm?category=977798](https://wookkingkim.tistory.com/m/entry/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-The-Bankers-Algorithm?category=977798)
