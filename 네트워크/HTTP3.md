# HTTP/3
- HTTP(Hypertext Transfer Protocol)의 세 번째 메이저 버전 
- TCP 기반의 HTTP/1, HTTP/2와는 다르게 UDP 기반의 프로토콜인 QUIC을 사용하여 통신하는 프로토콜
  <img width="413" alt="image" src="https://user-images.githubusercontent.com/66233687/193581643-f84b7cfc-f398-4eca-82e4-8ca60ad39e4e.png">

***

## TCP의 한계 : HOLB (Head Of Line Blocking)
- 패킷은 무조건 정확한 순서대로 처리(수신 측은 송신 측과 주고받은 시퀀스 번호를 참고하여 패킷 재조립)
- 통신 중간에 패킷이 손실되면 완전한 데이터로 다시 조립할 수 없음. 
- 송신 측은 수신 측이 패킷을 제대로 다 받았다는 것을 확인한 후, 만약 수신 측이 제대로 패킷을 받지 못했으면 해당 패킷을 다시 보냄.
- 패킷이 처리되는 순서 또한 정해져있으므로 이전에 받은 패킷을 파싱하기 전까지는 다음 패킷을 처리할 수도 없음. 
- 이렇게 패킷이 중간에 유실되거나 수신 측의 패킷 파싱 속도가 느리다면 통신에 병목이 발생하게 되는 현상이 일어남.

  <img width="840" alt="image" src="https://user-images.githubusercontent.com/66233687/193574248-c38277a7-a9d3-4f72-9375-242d50a8142c.png">

***

## QUIC (Quick UDP Internet Connections)
- 구글이 개발한 **UDP** 기반 전달 계층(Transfer Layer) 프로토콜

### 1. RTT 감소
> RTT(Round Trip Time): 클라이언트가 보낸 요청을 서버가 처리한 후 다시 클라이언트로 응답해주는 사이클
#### TCP
- 연결을 생성하기 위해 기본적으로 1 RTT가 필요하고, 여기에 TLS를 사용한 암호화까지 하려고 한다면 TLS의 자체 핸드쉐이크까지 더해져 총 3 RTT가 필요.
#### QUIC
- 첫 연결 설정에 1 RTT만 소요 (클라이언트가 서버에 신호를 한번 주고, 서버가 거기에 응답하기만 하면 바로 본 통신을 시작)
- 첫번째 핸드쉐이크를 거칠 때 연결 설정에 필요한 정보와 함께 데이터도 보냄.(단, 클라이언트가 서버로 첫 요청을 보낼 때는 서버의 세션 키를 모르는 상태이기 때문에 목적지인 서버의 Connection ID를 사용하여 생성한 특별한 키인 초기화 키(Initial Key)를 사용하여 통신을 암호화)
- 한번 연결에 성공했다면 서버는 그 설정을 캐싱해놓고 있다가, 다음 연결 때는 캐싱해놓은 설정을 사용하여 바로 연결을 성립시키기 때문에 0 RTT만으로 바로 통신을 시작함.
- 암호화가 프로토콜의 일부기능으로 포함 (암호화 통신 Default)

  <img width="409" alt="image" src="https://user-images.githubusercontent.com/66233687/193582029-f898b61f-9a9b-413c-b595-afcdcf20c9be.png">

### 2. 패킷 손실 감지 시간 단축
#### TCP
- Stop and Wait ARQ 방식 : 송신 측이 패킷을 보낸 후 타이머를 사용하여 시간을 재고, 일정 시간이 경과해도 수신 측이 적절한 답변을 주지 않는다면 패킷이 손실된 것으로 판단하고 해당 패킷을 다시 보내는 방식
- 정상적인 RTT들을 이용해 동적으로 타임 아웃 계산
- 패킷 손실이 발생하면 ACK가 어느 패킷에 대한 응답인지 모호해지는 <재전송의 모호성> 발생 : Timestamp를 패킷에 남기는 등 별도의 방안 필요
#### QUIC
- 헤더에 패킷의 전송 순서를 나타내는 패킷 번호 공간 부여
- 매 전송마다 패킷 번호가 증가 : 패킷의 전송 순서를 명확하게 파악 가능

### 3. 클라이언트의 IP가 바뀌어도 연결 유지
#### TCP
- 소스의 IP 주소와 포트, 연결 대상의 IP 주소와 포트로 연결을 식별하기 때문에 클라이언트의 IP가 바뀌는 상황이 발생하면 연결이 끊어짐. 
- 연결이 끊어졌으니 다시 연결을 생성하기 위해 결국 눈물나는 3 Way Handshake 과정을 다시 거침.
- 요즘은 Wi-fi에서 셀룰러로 전환되거나 그 반대의 경우, 혹은 다른 Wi-fi로 연결되는 경우와 같이 클라이언트의 IP가 변경되는 일이 굉장히 잦음.
#### QUIC
- QUIC은 Connection ID를 사용하여 서버와 연결을 생성 (Connection ID는 랜덤한 값일 뿐, 클라이언트의 IP와는 전혀 무관한 데이터)

  <img width="1006" alt="image" src="https://user-images.githubusercontent.com/66233687/193582865-3f253b4b-64e2-4360-9858-564092d65580.png">

### 4. 보안 강화
- 기존에 암호화되지 않던 영역까지 암호화에 포함해 보안성을 더 강화

![image](https://user-images.githubusercontent.com/66233687/193583203-691bad79-2cc0-448b-b166-b4305c5868b7.png)


### 5. 기타
- HTTP/2의 일부 기능들은 QUIC 위에서도 별도의 변환 없이 그대로 적용할 수 있음
- 그러나 적용할 수 없는 기능도 있음
  - ex) HPACK 이라는 HTTP/2에서 사용하던 헤더 압축 체계는 응답의 전달순서에 따라 크게 좌우되는데, QUIC는 스트림간의 순서를 보장하지 않기 때문에 사용할 수 없다.(이러한 경우 QPACK이라는 새로운 HTTP 헤더 압축체계를 작성했다고 한다.)
- 패킷별 개별 암호화 : 기존의 TLS-TCP에서 패킷을 묶어서 암호화하는 것보다 더 큰 리소스 소모를 불러올 수 있다는 단점.

참고
- https://evan-moon.github.io/2019/10/08/what-is-http3/
- https://www.hamadevelop.me/http3/
