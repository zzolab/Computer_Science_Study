# 인덱스

## 기본 개념
- **추가적인 쓰기 작업과 저장 공간을 활용**하여 데이터베이스 테이블의 **검색 속도**를 향상시키기 위한 자료구조
- 인덱스를 생성한 컬럼의 데이터들은 **정렬**되어 별도의 메모리 공간에 데이터의 물리적 주소와 함께 저장
-  쿼리문에 인덱스 생성 컬럼을 WHERE 조건으로 거는 등의 작업을 하면 옵티마이저에서 판단하여 생성된 인덱스를 탐.
> 옵티마이저 : 옵티마이저는 가장 효율적인 방법으로 SQL을 수행할 최적의 처리 경로를 생성해주는 DBMS의 핵심 엔진. 컴퓨터의 두뇌가 CPU인 것처럼 DBMS의 두뇌는 옵티마이저라고 할 수 있음.
- 인덱스 생성 시 데이터를 오름차순으로 정렬
- 아래의 그림과 같이 인덱스를 타게 되고 먼저 인덱스에 저장되어 있는 데이터의 물리적 주소로 가서 데이터를 가져오는 식으로 동작을 하여 검색 속도의 향상을 가져옴.
![image](https://user-images.githubusercontent.com/66233687/197685697-ce433134-4503-4e3e-a6af-c6383911ecad.png)

***

## 장점
- 테이블을 조회(검색)하는 속도 향상 : 인덱스에 의해 데이터들이 정렬된 형태 → Full Table Scan 작업할 필요 없음 → 속도와 성능 향상

***

## 단점
- 인덱스가 적용된 컬럼에 INSERT, UPDATE, DELETE가 수행된다면 계속 정렬을 해주어야 하고 그에 따른 부하 발생
- 인덱스를 관리하기 위해서는 데이터베이스의 약 10%에 해당하는 저장공간 추가 필요

***

## 생성 전략
- 조건절에 자주 등장하는 컬럼
- 항상 = 으로 비교되는 컬럼
- 중복되는 데이터가 최소한인 컬럼 (분포도가 좋은 컬럼)
- ORDER BY 절에서 자주 사용되는 컬럼
- JOIN 조건으로 자주 사용되는 컬럼

***

## 구조

### B-Tree
- B-Tree는 탐색 성능을 높이기 위해 균형 있게 높이를 유지하는 Balanced Tree의 일종
- 첫 생성 시 균형 트리이지만, 테이블 갱신(Insert, Update, Delete)의 반복으로 균형이 깨지며 성능이 악화될 수 있음.
- 모든 노드에 key와 data 담을 수 있음.
- B-Tree는 어느 한 데이터의 검색은 효율적이지만, 모든 데이터를 한 번 순회하는 데에는 트리의 모든 노드를 방문해야 하므로 비효율적

![image](https://user-images.githubusercontent.com/66233687/197695779-1af3403f-5c97-4e0c-ae24-9eff2d039395.png)

### B+Tree
- 오직 leaf node에만 데이터를 저장
- 상위 node에서는 자식 포인터만 저장
> 포인터 : 데이터가 저장된 주소값(메모리의 시작 주소)을 보관하는 변수
- leaf node끼리는 Linked list로 연결
- 중간 node에서 key를 올바르게 찾아가기 위해서 key가 중복될 수 있음.
- B+Tree의 Linked list를 이용하면 부등호를 이용한 순차 검색을 효율적으로 할 수 있음.

![image](https://user-images.githubusercontent.com/66233687/197695801-b0706d6f-8d60-4959-9e3a-74e22aac019e.png)


### B-Tree vs B+Tree
1. leaf node를 제외하고 데이터를 저장하지 않기 때문에 메모리를 더 확보할 수 있음. → 따라서 하나의 node에 더 많은 포인터를 가질 수 있기 때문에 트리의 높이가 더 낮아지므로 검색 속도를 높일 수 있음.
2. Full scan을 하는 경우 B-Tree는 모든 node를 확인해야 되는 반면, B+Tree는 leaf node끼리 linked list로 연결되어 있기 때문에 선형 시간이 소모
3. 그러나 B-Tree의 경우 최상의 경우 특정 key를 root node에서 찾을 수 있지만, B+Tree의 경우 반드시 특정 key에 접근하기 위해서 leaf node까지 가야 함.
 

# Ref
- https://choicode.tistory.com/27 [드럼치는 코린이의 개발 공간:티스토리]
- https://rebro.kr/167 [Rebro의 코딩 일기장:티스토리]
